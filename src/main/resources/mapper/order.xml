<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itbank.pethub.model.OrderDAO">

    <select id="getCartItemsByMemberId" resultType="com.itbank.pethub.vo.CartVO">
        SELECT * FROM cart WHERE member_id = #{memberId}
    </select>

    <update id="updateCartItem">
        UPDATE cart SET count = #{count} WHERE orderitems_id = #{itemId}
    </update>

    <delete id="deleteCartItem">
        DELETE FROM cart WHERE orderitems_id = #{itemId}
    </delete>

    <select id="getItemsByIds" resultType="com.itbank.pethub.vo.CartVO">
        <foreach item="itemId" index="index" collection="list" open="SELECT * FROM cart WHERE orderitems_id IN (" separator="," close=")">
            #{itemId}
        </foreach>
    </select>

    <select id="getMemberById" resultType="com.itbank.pethub.vo.MemberVO">
        SELECT * FROM member WHERE id = #{memberId}
    </select>

    <insert id="insertOrder">
        INSERT INTO orders (member_id, order_status, order_date, payment_method, merchant_uid)
        VALUES (#{member_id}, #{order_status}, #{order_date}, #{payment_method}, #{merchant_uid})
    </insert>

    <update id="updateOrderItemStatus">
        UPDATE order_items SET status = #{status} WHERE id = #{itemId}
    </update>

    <delete id="clearCart">
        DELETE FROM cart WHERE member_id = #{memberId} AND orderitems_id IN
        <foreach item="itemId" index="index" collection="itemIds" open="(" separator="," close=")">
            #{itemId}
        </foreach>
    </delete>
</mapper>